(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const B="http://localhost:3000";async function V(e){try{const t=`${B}/users`,n=await fetch(t);if(!n.ok)throw new Error("Error al consultar el servidor");return(await n.json()).find(r=>r.id.toString()===e.toString())||null}catch(t){return console.error("‚ùå Error al buscar usuario:",t),null}}async function M(e){try{const t=`${B}/tasks`,n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},a=await fetch(t,n);if(!a.ok)throw new Error("Error al registrar la tarea");return await a.json()}catch(t){return console.error("‚ùå Error al registrar tarea:",t),null}}async function R(e,t){try{const n=`${B}/tasks/${e}`,a={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},o=await fetch(n,a);if(!o.ok)throw new Error(`Error al actualizar la tarea con ID ${e}`);return await o.json()}catch(n){return console.error("‚ùå Error al actualizar tarea:",n),null}}async function _(e){try{const t=`${B}/tasks/${e}`;if(!(await fetch(t,{method:"DELETE"})).ok)throw new Error(`Error al eliminar la tarea con ID ${e}`);return!0}catch(t){return console.error("‚ùå Error al eliminar tarea:",t),!1}}function I(e){return e.trim().length>0}function v(e,t,n){e.textContent=n,t.classList.add("error")}function c(e,t){e.textContent="",t.classList.remove("error")}function J(e,t){const n=e.value;let a=!0;return I(n)?c(t,e):(v(t,e,"El documento del usuario es obligatorio"),a=!1),a}function q(e,t,n,a,o,r){const s=e.value,d=t.value,m=n.value;let i=!0;return I(s)?c(a,e):(v(a,e,"El t√≠tulo de la tarea es obligatorio"),i=!1),I(d)?c(o,t):(v(o,t,"La descripci√≥n de la tarea es obligatoria"),i=!1),I(m)?c(r,n):(v(r,n,"Debes seleccionar un estado para la tarea"),i=!1),i}const A=document.getElementById("userDataSection"),j=document.getElementById("userId"),N=document.getElementById("userName"),O=document.getElementById("userEmail"),U=document.getElementById("taskFormSection"),L=document.getElementById("taskTitle"),C=document.getElementById("taskDescription"),D=document.getElementById("taskStatus"),H=document.getElementById("taskTitleError"),G=document.getElementById("taskDescriptionError"),K=document.getElementById("taskStatusError"),Q=document.getElementById("tasksSection"),W=document.getElementById("tasksCount"),X=document.getElementById("tasksTableBody"),F=document.getElementById("tasksEmptyState");function Y(e){A.classList.remove("hidden"),j.textContent=e.id,N.textContent=e.name,O.textContent=e.email}function Z(){A.classList.add("hidden"),j.textContent="",N.textContent="",O.textContent=""}function ee(){U.classList.remove("hidden")}function te(){U.classList.add("hidden")}function ne(){Q.classList.remove("hidden")}function oe(){F.classList.remove("hidden")}function ae(){F.classList.add("hidden")}function re(e){const t=e===1?`${e} tarea`:`${e} tareas`;W.textContent=t}function se(e){switch(e){case"pendiente":return"Pendiente";case"en_progreso":return"En Progreso";case"completada":return"Completada";default:return e}}function ie(e,t){const n=document.createElement("tr");n.dataset.id=e.id;const a=document.createElement("td");a.textContent=t+1;const o=document.createElement("td");o.textContent=e.title;const r=document.createElement("td");r.textContent=e.description;const s=document.createElement("td"),d=document.createElement("span");d.classList.add("status-badge"),d.classList.add(`status-${e.status}`),d.textContent=se(e.status),s.appendChild(d);const m=document.createElement("td");m.textContent=e.userName;const i=document.createElement("td"),p=document.createElement("div");p.classList.add("task-actions");const f=document.createElement("button");f.textContent="‚úèÔ∏è Editar",f.classList.add("btn-action","btn-action--edit"),f.dataset.id=e.id,f.dataset.action="edit",f.type="button";const l=document.createElement("button");return l.textContent="üóëÔ∏è Eliminar",l.classList.add("btn-action","btn-action--delete"),l.dataset.id=e.id,l.dataset.action="delete",l.type="button",p.appendChild(f),p.appendChild(l),i.appendChild(p),n.appendChild(a),n.appendChild(o),n.appendChild(r),n.appendChild(s),n.appendChild(m),n.appendChild(i),n}function ce(e,t){const n=ie(e,t);X.appendChild(n),re(t+1),ae(),ne()}function de(){L.value="",C.value="",D.value="",c(H,L),c(G,C),c(K,D)}function le(e){const t=document.getElementById("editModal");document.getElementById("editTaskTitle").value=e.title,document.getElementById("editTaskDescription").value=e.description,document.getElementById("editTaskStatus").value=e.status,document.getElementById("editTaskId").value=e.id,t.classList.remove("hidden")}function S(){document.getElementById("editModal").classList.add("hidden"),document.getElementById("editTaskTitle").value="",document.getElementById("editTaskDescription").value="",document.getElementById("editTaskStatus").value="",document.getElementById("editTaskId").value=""}function u(e,t="info"){let n=document.getElementById("notificaciones-contenedor");n||(n=document.createElement("div"),n.id="notificaciones-contenedor",document.body.appendChild(n));const a=document.createElement("div");a.classList.add("notificacion",`notificacion--${t}`),a.textContent=e,n.appendChild(a),setTimeout(()=>a.remove(),6e3)}function $(e,t,n){const a=t.trim(),o=n.trim();return!a&&!o?[...e]:e.filter(r=>{const s=!a||r.status===a,d=!o||r.userId.toString()===o;return s&&d})}const x={pendiente:1,en_progreso:2,completada:3};function P(e,t){return t?e.slice().sort((n,a)=>{switch(t){case"titulo":return n.title.localeCompare(a.title,"es",{sensitivity:"base"});case"estado":const o=x[n.status]??99,r=x[a.status]??99;return o-r;case"fecha":return Number(n.id)-Number(a.id);default:return 0}}):[...e]}function ue(e){if(!e||e.length===0)return console.warn("‚ö†Ô∏è No hay tareas visibles para exportar"),!1;const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a;const r=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);return o.download=`tareas_${r}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(a),1e3),!0}let g=null,E=[],T="",h="",b="";function me(){g=null,Z(),te()}function y(){const e=$(E,T,h),t=P(e,b),n=document.getElementById("tasksTableBody");n.innerHTML="",t.forEach((a,o)=>{ce(a,o)})}async function Ee(e){e.preventDefault();const t=document.getElementById("userDocument"),n=document.getElementById("userDocumentError");if(!J(t,n))return;const o=t.value.trim();me();const r=await V(o);r?(g=r,Y(r),ee(),t.value="",c(n,t)):(v(n,t,"No se encontr√≥ ning√∫n usuario con ese documento"),g=null)}async function fe(e){if(e.preventDefault(),!g){u("Primero debes buscar y seleccionar un usuario","error");return}const t=document.getElementById("taskTitle"),n=document.getElementById("taskDescription"),a=document.getElementById("taskStatus"),o=document.getElementById("taskTitleError"),r=document.getElementById("taskDescriptionError"),s=document.getElementById("taskStatusError");if(!q(t,n,a,o,r,s))return;const m={title:t.value.trim(),description:n.value.trim(),status:a.value,userId:g.id,userName:g.name,completed:a.value==="completada"},i=await M(m);i?(E.push(i),de(),y(),u("Tarea registrada exitosamente","exito")):u("Error al registrar la tarea. Por favor, intenta nuevamente.","error")}function pe(e){le(e);const t=document.getElementById("editTaskForm");async function n(s){s.preventDefault();const d=document.getElementById("editTaskTitle").value.trim(),m=document.getElementById("editTaskDescription").value.trim(),i=document.getElementById("editTaskStatus").value,p=document.getElementById("editTaskId").value,l=await R(p,{title:d,description:m,status:i,completed:i==="completada"});if(l){const k=E.findIndex(z=>z.id.toString()===l.id.toString());k!==-1&&(E[k]=l),y(),S(),u("Tarea actualizada exitosamente","exito")}else u("Error al actualizar la tarea. Por favor, intenta nuevamente.","error");t.removeEventListener("submit",n)}t.addEventListener("submit",n);const a=document.getElementById("editCancelBtn"),o=document.getElementById("editCloseBtn");function r(){S(),t.removeEventListener("submit",n),a.removeEventListener("click",r),o.removeEventListener("click",r)}a.addEventListener("click",r),o.addEventListener("click",r)}async function ge(e){if(!confirm(`¬øEst√°s seguro de que deseas eliminar la tarea "${e.title}"?
Esta acci√≥n no se puede deshacer.`))return;await _(e.id)?(E=E.filter(a=>a.id.toString()!==e.id.toString()),y(),u("Tarea eliminada exitosamente","exito")):u("Error al eliminar la tarea. Por favor, intenta nuevamente.","error")}function ye(e){const n=e.target.closest("[data-action]");if(!n)return;const a=n.dataset.id,o=n.dataset.action,r=E.find(s=>s.id.toString()===a.toString());if(!r){console.warn(`‚ö†Ô∏è No se encontr√≥ la tarea con id ${a} en el estado local`);return}switch(o){case"edit":pe(r);break;case"delete":ge(r);break;default:console.warn(`‚ö†Ô∏è Acci√≥n desconocida: ${o}`)}}function w(){T=document.getElementById("filtroEstado").value,h=document.getElementById("filtroUsuario").value,y()}function ve(){b=document.getElementById("ordenSelect").value,y()}function Be(){const e=$(E,T,h),t=P(e,b);ue(t)?u("Tareas exportadas exitosamente","exito"):u("No hay tareas visibles para exportar","info")}function Ie(){document.getElementById("searchUserForm").addEventListener("submit",Ee),document.getElementById("userDocument").addEventListener("input",function(){c(document.getElementById("userDocumentError"),document.getElementById("userDocument"))}),document.getElementById("taskForm").addEventListener("submit",fe),document.getElementById("taskTitle").addEventListener("input",function(){c(document.getElementById("taskTitleError"),document.getElementById("taskTitle"))}),document.getElementById("taskDescription").addEventListener("input",function(){c(document.getElementById("taskDescriptionError"),document.getElementById("taskDescription"))}),document.getElementById("taskStatus").addEventListener("change",function(){c(document.getElementById("taskStatusError"),document.getElementById("taskStatus"))}),document.getElementById("tasksTableBody").addEventListener("click",ye),document.getElementById("filtroEstado").addEventListener("change",w),document.getElementById("filtroUsuario").addEventListener("input",w),document.getElementById("limpiarFiltros").addEventListener("click",function(){document.getElementById("filtroEstado").value="",document.getElementById("filtroUsuario").value="",T="",h="",y()}),document.getElementById("ordenSelect").addEventListener("change",ve),document.getElementById("exportarBtn").addEventListener("click",Be)}document.addEventListener("DOMContentLoaded",function(){console.log("DOM completamente cargado y listo"),console.log("Sistema de Gesti√≥n de Tareas - SENA iniciando..."),console.log("Servidor esperado en:",B),Ie(),oe(),console.log("üìã Event listeners registrados correctamente"),console.log("‚úîÔ∏è  Aplicaci√≥n lista para usar")});
